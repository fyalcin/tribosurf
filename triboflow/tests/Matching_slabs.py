#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed Jun 30 12:56:41 2021

@author: wolloch
"""
from mpinterfaces.transformations import get_aligned_lattices
from pymatgen.core.surface import Slab
from triboflow.phys.interface_matcher import MatchInterface
alc111_dict = {'@module': 'pymatgen.core.surface',
 '@class': 'Slab',
 'charge': None,
 'lattice': {'matrix': [[4.953950000000101, 0.0, 3.0334195053180773e-16],
   [2.476975866025646, 4.290247499999913, 3.033420274724064e-16],
   [0.0, 0.0, 32.005944]],
  'a': 4.953950000000101,
  'b': 4.953951256535434,
  'c': 32.005944,
  'alpha': 90.0,
  'beta': 90.0,
  'gamma': 59.99999682476928,
  'volume': 680.2438231080062},
 'sites': [{'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.666667, 0.666667, 0.387696],
   'xyz': [4.953953054325787, 2.860166430082442, 12.408576465024],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.333333, 0.333333, 0.387696],
   'xyz': [2.47697281169996, 1.430081069917471, 12.408576465024],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.0, 0.0, 0.387696],
   'xyz': [0.0, 0.0, 12.408576465024],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.333333, 0.666667, 0.462678],
   'xyz': [3.302633085025753, 2.860166430082442, 14.808446158032],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [1.0, 0.333334, 0.462678],
   'xyz': [5.779610273325893, 1.4300853601649712, 14.808446158032],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.666666, 0.0, 0.462678],
   'xyz': [3.302630030700067, 0.0, 14.808446158032],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.666667, 0.333333, 0.537322],
   'xyz': [4.1282927809999945, 1.430081069917471, 17.197497841967998],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.333334, 1.0, 0.537322],
   'xyz': [4.128295835325679, 4.290247499999913, 17.197497841967998],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.0, 0.666666, 0.537322],
   'xyz': [1.651315592699853, 2.860162139834942, 17.197497841967998],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.666667, 0.666667, 0.612304],
   'xyz': [4.953953054325787, 2.860166430082442, 19.597367534975998],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.333333, 0.333333, 0.612304],
   'xyz': [2.47697281169996, 1.430081069917471, 19.597367534975998],
   'label': 'Al',
   'properties': {}},
  {'species': [{'element': 'C', 'occu': 1}],
   'abc': [0.0, 0.0, 0.612304],
   'xyz': [0.0, 0.0, 19.597367534975998],
   'label': 'C',
   'properties': {}}],
 'oriented_unit_cell': {'@module': 'pymatgen.core.structure',
  '@class': 'Structure',
  'charge': None,
  'lattice': {'matrix': [[1e-06, 4.95395, 0.0],
    [4.290248, 2.476975, 0.0],
    [-0.0, -0.0, -32.005944]],
   'a': 4.953950000000101,
   'b': 4.953951256535434,
   'c': 32.005944,
   'alpha': 90.0,
   'beta': 90.0,
   'gamma': 59.99999682476928,
   'volume': 680.243823108006},
  'sites': [{'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.666667, 0.666667, 0.387696],
    'xyz': [2.860167430083, 4.953952476975, -12.408576465024],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.333333, 0.333333, 0.387696],
    'xyz': [1.430081569917, 2.4769725230249997, -12.408576465024],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.0, 0.0, 0.387696],
    'xyz': [0.0, 0.0, -12.408576465024],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.333333, 0.666667, 0.462678],
    'xyz': [2.860167096749, 3.302632507675, -14.808446158032],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [1.0, 0.333334, 0.462678],
    'xyz': [1.430086526832, 5.7796099846499995, -14.808446158032],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.666666, 0.0, 0.462678],
    'xyz': [6.666659999999999e-07, 3.3026300306999996, -14.808446158032],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.666667, 0.333333, 0.537322],
    'xyz': [1.430081903251, 4.128292492325, -17.197497841967998],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.333334, 1.0, 0.537322],
    'xyz': [4.2902483333340005, 4.1282949693, -17.197497841967998],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.0, 0.666666, 0.537322],
    'xyz': [2.8601624731679998, 1.6513150153499998, -17.197497841967998],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.666667, 0.666667, 0.612304],
    'xyz': [2.860167430083, 4.953952476975, -19.597367534975998],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.333333, 0.333333, 0.612304],
    'xyz': [1.430081569917, 2.4769725230249997, -19.597367534975998],
    'label': 'Al',
    'properties': {}},
   {'species': [{'element': 'C', 'occu': 1}],
    'abc': [0.0, 0.0, 0.612304],
    'xyz': [0.0, 0.0, -19.597367534975998],
    'label': 'C',
    'properties': {}}]},
 'miller_index': (1, 1, 1),
 'shift': 0,
 'scale_factor': [[1, 0, 0], [0, 1, 0], [0, 0, 1]],
 'reconstruction': None,
 'energy': None}

cuau111_dict = {'@module': 'pymatgen.core.surface',
 '@class': 'Slab',
 'charge': None,
 'lattice': {'matrix': [[5.134393814334074, 0.0, 3.143909475143097e-16],
   [2.5671960928329307, 4.446516160791427, 3.143909588830688e-16],
   [0.0, 0.0, 31.288323]],
  'a': 5.134393814334074,
  'b': 5.134394,
  'c': 31.288323,
  'alpha': 90.0,
  'beta': 90.0,
  'gamma': 60.000011689341854,
  'volume': 714.3175788942775},
 'sites': [{'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.5, 0.5, 0.401016],
   'xyz': [3.8507949535835024, 2.2232580803957136, 12.547118136167999],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.5, 1.0, 0.401016],
   'xyz': [5.134392999999967, 4.446516160791427, 12.547118136167999],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.0, 0.5, 0.401016],
   'xyz': [1.2835980464164654, 2.2232580803957136, 12.547118136167999],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.0, 0.0, 0.401016],
   'xyz': [0.0, 0.0, 12.547118136167999],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.166666, 0.666667, 0.466994],
   'xyz': [2.567193797080454, 2.9643455893663386, 14.611459111062],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.166666, 0.166667, 0.466994],
   'xyz': [1.2835957506639888, 0.7410875089706248, 14.611459111062],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.666666, 0.666667, 0.466994],
   'xyz': [5.134390704247491, 2.9643455893663386, 14.611459111062],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.666666, 0.166667, 0.466994],
   'xyz': [3.850792657831026, 0.7410875089706248, 14.611459111062],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.333334, 0.333333, 0.533006],
   'xyz': [2.5671992029195136, 1.4821705714250888, 16.676863888937998],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.333334, 0.833333, 0.533006],
   'xyz': [3.850797249335979, 3.705428651820802, 16.676863888937998],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.833333, 0.333333, 0.533006],
   'xyz': [5.134390975692736, 1.4821705714250888, 16.676863888937998],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.833333, 0.833333, 0.533006],
   'xyz': [6.417989022109202, 3.705428651820802, 16.676863888937998],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.5, 0.5, 0.598984],
   'xyz': [3.8507949535835024, 2.2232580803957136, 18.741204863832],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.5, 1.0, 0.598984],
   'xyz': [5.134392999999967, 4.446516160791427, 18.741204863832],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.0, 0.5, 0.598984],
   'xyz': [1.2835980464164654, 2.2232580803957136, 18.741204863832],
   'label': 'Cu',
   'properties': {}},
  {'species': [{'element': 'Au', 'occu': 1}],
   'abc': [0.0, 0.0, 0.598984],
   'xyz': [0.0, 0.0, 18.741204863832],
   'label': 'Au',
   'properties': {}}],
 'oriented_unit_cell': {'@module': 'pymatgen.core.structure',
  '@class': 'Structure',
  'charge': None,
  'lattice': {'matrix': [[2.567196, 4.446516, 0.0],
    [5.134394, -0.0, 0.0],
    [-0.0, -0.0, -31.288323]],
   'a': 5.134393814334074,
   'b': 5.134394,
   'c': 31.288323,
   'alpha': 90.0,
   'beta': 90.0,
   'gamma': 60.000011689341854,
   'volume': 714.3175788942776},
  'sites': [{'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.5, 0.5, 0.401016],
    'xyz': [3.850795, 2.223258, -12.547118136167999],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.5, 1.0, 0.401016],
    'xyz': [6.417992, 2.223258, -12.547118136167999],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.0, 0.5, 0.401016],
    'xyz': [2.567197, 0.0, -12.547118136167999],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.0, 0.0, 0.401016],
    'xyz': [0.0, 0.0, -12.547118136167999],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.166666, 0.666667, 0.466994],
    'xyz': [3.850795333334, 0.741083035656, -14.611459111062],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.166666, 0.166667, 0.466994],
    'xyz': [1.2835983333340002, 0.741083035656, -14.611459111062],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.666666, 0.666667, 0.466994],
    'xyz': [5.134393333334001, 2.964341035656, -14.611459111062],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.666666, 0.166667, 0.466994],
    'xyz': [2.567196333334, 2.964341035656, -14.611459111062],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.333334, 0.333333, 0.533006],
    'xyz': [2.567196666666, 1.482174964344, -16.676863888937998],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.333334, 0.833333, 0.533006],
    'xyz': [5.134393666666, 1.482174964344, -16.676863888937998],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.833333, 0.333333, 0.533006],
    'xyz': [3.85079209947, 3.705428517828, -16.676863888937998],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.833333, 0.833333, 0.533006],
    'xyz': [6.41798909947, 3.705428517828, -16.676863888937998],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.5, 0.5, 0.598984],
    'xyz': [3.850795, 2.223258, -18.741204863832],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.5, 1.0, 0.598984],
    'xyz': [6.417992, 2.223258, -18.741204863832],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.0, 0.5, 0.598984],
    'xyz': [2.567197, 0.0, -18.741204863832],
    'label': 'Cu',
    'properties': {}},
   {'species': [{'element': 'Au', 'occu': 1}],
    'abc': [0.0, 0.0, 0.598984],
    'xyz': [0.0, 0.0, -18.741204863832],
    'label': 'Au',
    'properties': {}}]},
 'miller_index': (1, 1, 1),
 'shift': 0,
 'scale_factor': [[1, 0, 0], [0, 1, 0], [0, 0, 1]],
 'reconstruction': None,
 'energy': None}
al111_dict = {'@module': 'pymatgen.core.surface',
 '@class': 'Slab',
 'charge': None,
 'lattice': {'matrix': [[2.860165, 0.0, 1.7513459561416446e-16],
   [-1.430082, 2.476975, 1.751345511924877e-16],
   [0.0, 0.0, 32.005944]],
  'a': 2.860165,
  'b': 2.860164274538964,
  'c': 32.005944,
  'alpha': 90.0,
  'beta': 90.0,
  'gamma': 119.99999682477132,
  'volume': 226.74794103600198},
 'sites': [{'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.0, 0.0, 0.38769624],
   'xyz': [0.0, 0.0, 12.408584146450561],
   'label': 'Al',
   'properties': {'magmom': 0.0}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.333333, 0.666667, 0.46267833],
   'xyz': [-1.0967490001730144e-06, 1.651317492325, 14.80845671999352],
   'label': 'Al',
   'properties': {'magmom': -0.0}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.0, 0.0, 0.61230376],
   'xyz': [0.0, 0.0, 19.597359853549438],
   'label': 'Al',
   'properties': {'magmom': 0.0}},
  {'species': [{'element': 'Al', 'occu': 1}],
   'abc': [0.666667, 0.333333, 0.53732167],
   'xyz': [1.4300840967489998, 0.8256575076749999, 17.197487280006477],
   'label': 'Al',
   'properties': {'magmom': -0.0}}],
 'oriented_unit_cell': {'@module': 'pymatgen.core.structure',
  '@class': 'Structure',
  'charge': None,
  'lattice': {'matrix': [[2.860165, 0.0, 0.0],
    [-1.430082, 2.476975, 0.0],
    [0.0, 0.0, 32.005944]],
   'a': 2.860165,
   'b': 2.860164274538964,
   'c': 32.005944,
   'alpha': 90.0,
   'beta': 90.0,
   'gamma': 119.99999682477132,
   'volume': 226.74794103600198},
  'sites': [{'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.0, 0.0, 0.38769624],
    'xyz': [0.0, 0.0, 12.408584146450561],
    'label': 'Al',
    'properties': {'magmom': 0.0}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.333333, 0.666667, 0.46267833],
    'xyz': [-1.0967490001730144e-06, 1.651317492325, 14.80845671999352],
    'label': 'Al',
    'properties': {'magmom': -0.0}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.0, 0.0, 0.61230376],
    'xyz': [0.0, 0.0, 19.597359853549438],
    'label': 'Al',
    'properties': {'magmom': 0.0}},
   {'species': [{'element': 'Al', 'occu': 1}],
    'abc': [0.666667, 0.333333, 0.53732167],
    'xyz': [1.4300840967489998, 0.8256575076749999, 17.197487280006477],
    'label': 'Al',
    'properties': {'magmom': -0.0}}]},
 'miller_index': (1, 1, 1),
 'shift': 0,
 'scale_factor': [[1, 0, 0], [0, 1, 0], [0, 0, 1]],
 'reconstruction': None,
 'energy': None}

cu111_dict = {'@module': 'pymatgen.core.surface',
 '@class': 'Slab',
 'charge': None,
 'lattice': {'matrix': [[2.567197, 0.0, 1.571954794415344e-16],
   [-1.2835990000000004, 2.2232580000000004, 1.5719550437332295e-16],
   [0.0, 0.0, 31.288323]],
  'a': 2.567197,
  'b': 2.567197407167007,
  'c': 31.288323,
  'alpha': 90.0,
  'beta': 90.0,
  'gamma': 120.00000763897559,
  'volume': 178.57939472356944},
 'sites': [{'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.0, -0.0, 0.40101582],
   'xyz': [0.0, 0.0, 12.54711250426986],
   'label': 'Cu',
   'properties': {'magmom': -0.0}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.333333, 0.666667, 0.46699376],
   'xyz': [-1.6169320002745272e-06, 1.4821727410860004, 14.611451601864479],
   'label': 'Cu',
   'properties': {'magmom': -0.0}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.0, -0.0, 0.59898418],
   'xyz': [0.0, 0.0, 18.741210495730137],
   'label': 'Cu',
   'properties': {'magmom': -0.0}},
  {'species': [{'element': 'Cu', 'occu': 1}],
   'abc': [0.666667, 0.333333, 0.53300624],
   'xyz': [1.2835996169319999, 0.7410852589140001, 16.676871398135518],
   'label': 'Cu',
   'properties': {'magmom': -0.0}}],
 'oriented_unit_cell': {'@module': 'pymatgen.core.structure',
  '@class': 'Structure',
  'charge': None,
  'lattice': {'matrix': [[2.567197, 0.0, 0.0],
    [-1.283599, 2.223258, 0.0],
    [0.0, 0.0, 31.288323]],
   'a': 2.567197,
   'b': 2.567197407167006,
   'c': 31.288323,
   'alpha': 90.0,
   'beta': 90.0,
   'gamma': 120.00000763897559,
   'volume': 178.5793947235694},
  'sites': [{'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.0, -0.0, 0.40101582],
    'xyz': [0.0, 0.0, 12.54711250426986],
    'label': 'Cu',
    'properties': {'magmom': -0.0}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.333333, 0.666667, 0.46699376],
    'xyz': [-1.6169319999784675e-06, 1.482172741086, 14.611451601864479],
    'label': 'Cu',
    'properties': {'magmom': -0.0}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.0, -0.0, 0.59898418],
    'xyz': [0.0, 0.0, 18.741210495730137],
    'label': 'Cu',
    'properties': {'magmom': -0.0}},
   {'species': [{'element': 'Cu', 'occu': 1}],
    'abc': [0.666667, 0.333333, 0.53300624],
    'xyz': [1.283599616932, 0.741085258914, 16.676871398135518],
    'label': 'Cu',
    'properties': {'magmom': -0.0}}]},
 'miller_index': (1, 1, 1),
 'shift': 0,
 'scale_factor': [[1, 0, 0], [0, 1, 0], [0, 0, 1]],
 'reconstruction': None,
 'energy': None}

al111 = Slab.from_dict(al111_dict)
al_bm = 76.50705929207275
cu111 = Slab.from_dict(cu111_dict)
cu_bm = 139.67909156673758
match_params = {'max_area': 200.0,
                'max_mismatch': 0.01,
                'max_angle_diff': 1.5,
                'r1r2_tol': 0.2,
                'best_match': 'area'
                }

Matcher = MatchInterface(slab_2=al111,
                         slab_1=cu111,
                         strain_weight_1=al_bm,
                         strain_weight_2=cu_bm,
                         **match_params)


#al111_new, cu111_new = Matcher.get_aligned_slabs()
interface = Matcher.get_interface()

# al111_old, cu111_old = get_aligned_lattices(
#                 al111,
#                 cu111,
#                 **match_params)